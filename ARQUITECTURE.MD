# üèóÔ∏è Arquitetura do Projeto ‚Äì Assistente de Tarefas por Conversa

Este documento define **as regras arquiteturais oficiais** do projeto.
Qualquer c√≥digo, feature ou refatora√ß√£o **deve seguir este guia**.

> Objetivo: manter o sistema **simples, test√°vel, seguro e evolutivo**.

---

## üéØ Vis√£o Geral

Aplica√ß√£o backend-first que transforma mensagens em linguagem natural (PT-BR) em a√ß√µes estruturadas:

* Tarefas
* Lembretes
* Lembretes recorrentes
* Notas

A IA **interpreta**, mas **n√£o decide nem executa**.

---

## üß† Princ√≠pios Fundamentais

1. **Separa√ß√£o de responsabilidades**
2. **Dom√≠nio independente de frameworks**
3. **Tudo que importa √© test√°vel**
4. **Seguran√ßa por padr√£o**
5. **Nada impl√≠cito ou m√°gico**

---

## üóÇÔ∏è Camadas da Arquitetura (Clean Architecture)

### 1Ô∏è‚É£ Domain (n√∫cleo do sistema)

üìç N√£o depende de NestJS, Prisma, banco ou IA.

Respons√°vel por:

* Entidades (Task, Recurrence, Note, User)
* Regras de neg√≥cio
* Valida√ß√µes
* Invariantes

üö´ Proibido no dom√≠nio:

* Decorators
* DTOs
* HTTP
* Banco de dados
* Servi√ßos externos

üì¶ Exemplo de estrutura:

```
/domain
  /entities
  /value-objects
  /errors
```

---

### 2Ô∏è‚É£ Application (casos de uso)

üìç Orquestra o dom√≠nio.

Respons√°vel por:

* Casos de uso (CreateTask, InterpretMessage)
* Coordena√ß√£o entre dom√≠nio e infraestrutura
* Decis√µes de fluxo

Pode depender de:

* Interfaces
* Contratos

N√£o pode depender de:

* Implementa√ß√µes concretas

---

### 3Ô∏è‚É£ Infrastructure (implementa√ß√µes)

üìç Onde vivem as coisas reais.

Respons√°vel por:

* Prisma
* Banco de dados
* Providers de IA
* Hash de senha
* JWT

Aqui mora o "como", nunca o "por qu√™".

---

### 4Ô∏è‚É£ API (interface externa)

üìç Camada mais burra poss√≠vel.

Respons√°vel por:

* Controllers
* DTOs
* Valida√ß√£o de entrada (Zod)
* Autentica√ß√£o

üö´ Controllers N√ÉO:

* cont√™m regras de neg√≥cio
* acessam banco diretamente

---

## üîê Seguran√ßa (obrigat√≥rio)

### Autentica√ß√£o

* JWT de curta dura√ß√£o
* Refresh token rotacion√°vel
* Refresh tokens armazenados com hash

### Autoriza√ß√£o

* Toda query filtrada por user_id
* Nunca confiar em dados do client

### IA

* Input sanitizado
* Limite de tamanho
* Timeout
* Resposta validada por schema

---

## üß™ Estrat√©gia de Testes

### Testes Unit√°rios

* Dom√≠nio (prioridade m√°xima)
* Casos de uso

### Testes de Integra√ß√£o

* Endpoints
* Autentica√ß√£o
* Persist√™ncia

### Testes de Regress√£o Sem√¢ntica

* Dataset fixo de frases
* Verifica√ß√£o de tipo e flags

üö´ Testes nunca dependem de servi√ßos externos.

---

## ü§ñ Intelig√™ncia Artificial

### Papel da IA

* Interpretar texto
* Retornar estrutura

### Limita√ß√µes

* IA n√£o cria registros diretamente
* IA n√£o decide datas finais
* IA n√£o executa l√≥gica

### Contrato

* Sempre JSON v√°lido
* Validado via Zod
* Falha = fallback seguro

---

## üìú Auditoria & Logs

Tudo que altera estado relevante:

* √â auditado
* √â rastre√°vel

Logs devem:

* Ajudar debugging
* Nunca conter dados sens√≠veis

---

## üö¶ Regras de Evolu√ß√£o

Antes de adicionar qualquer feature:

1. Onde isso vive? (camada)
2. √â test√°vel?
3. Que regra protege isso?

Se n√£o souber responder, **n√£o implemente ainda**.

---

## üß† Regra Final

> C√≥digo simples sobrevive.
> C√≥digo m√°gico cobra juros.

Este documento √© a **fonte da verdade arquitetural** do projeto.
